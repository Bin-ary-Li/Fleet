<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fleet: src/Hypotheses/GrammarHypothesis.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_sm.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Fleet
   &#160;<span id="projectnumber">0.0.9</span>
   </div>
   <div id="projectbrief">Inference in the LOT</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_abe3370eff6f4985b2e16a72e5a48fe2.html">Hypotheses</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GrammarHypothesis.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_grammar_hypothesis_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#pragma once </span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;Eigen/Core&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_numerics_8h.html">Numerics.h</a>&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_eigen_numerics_8h.html">EigenNumerics.h</a>&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> t_learnerdatum, <span class="keyword">typename</span> t_learnerdata=std::vector&lt;t_learnerdatum&gt;&gt;</div><div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="struct_human_datum.html">    9</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_human_datum.html">HumanDatum</a> { </div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="comment">// a data structure to store our loaded human data. This stores responses for a prediction</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    <span class="comment">// conditioned on given data, with yes/no responses</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    <span class="comment">// We have T as our own inherited type so we can write comparisons, is_data_prefix etc for subtypes</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;    <span class="comment">// NOTE: we may want to abstract out a response type as well</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    </div><div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="struct_human_datum.html#a3569e7634ea9badbe48105cb3a4e5800">   15</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="struct_human_datum.html#a3569e7634ea9badbe48105cb3a4e5800">cntyes</a>; <span class="comment">// yes and no responses</span></div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="struct_human_datum.html#a713ec5993bc2a348a73f292865a6ddcf">   16</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="struct_human_datum.html#a713ec5993bc2a348a73f292865a6ddcf">cntno</a>;</div><div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="struct_human_datum.html#aab13b229dfedb8c2466f47a58e710431">   17</a></span>&#160;    t_learnerdata  <a class="code" href="struct_human_datum.html#aab13b229dfedb8c2466f47a58e710431">given_data</a>;   <span class="comment">// what data they saw</span></div><div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="struct_human_datum.html#ab4676fce2bedc28aca179a17fce99be2">   18</a></span>&#160;    t_learnerdatum <a class="code" href="struct_human_datum.html#ab4676fce2bedc28aca179a17fce99be2">predict_data</a>; <span class="comment">// what they responded to</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;};</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/* Helper functions for computing counts, C, LL, P */</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> HYP&gt;</div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="_grammar_hypothesis_8h.html#ae5fe4a8381157a1e6b65f806a80e941e">   25</a></span>&#160;<a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> <a class="code" href="_grammar_hypothesis_8h.html#ae5fe4a8381157a1e6b65f806a80e941e">counts</a>(HYP&amp; h) {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="comment">// returns a 1xnRules matrix of how often each rule occurs</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">// TODO: This will not work right for Lexicons, where value is not there</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">auto</span> c = h.grammar-&gt;get_counts(h.value);</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> out = Vector::Zero(c.size());</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0;i&lt;c.size();i++){</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        out(i) = c[i];</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    }</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    </div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">return</span> out;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;}</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> HYP&gt;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="_grammar_hypothesis_8h.html#aa9cc572967622742aa6eb6603f58dbd0">   41</a></span>&#160;<a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> <a class="code" href="_grammar_hypothesis_8h.html#ae5fe4a8381157a1e6b65f806a80e941e">counts</a>(std::vector&lt;HYP&gt;&amp; hypotheses) {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">/* Returns a matrix of hypotheses (rows) by counts of each grammar rule.</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">       (requires that each hypothesis use the same grammar) */</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;       </div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    assert(hypotheses.size() &gt; 0);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordtype">size_t</span> nRules = hypotheses[0].grammar-&gt;count_rules();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> out = Matrix::Zero(hypotheses.size(), nRules); </div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0;i&lt;hypotheses.size();i++) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        out.row(i) = <a class="code" href="_grammar_hypothesis_8h.html#ae5fe4a8381157a1e6b65f806a80e941e">counts</a>(hypotheses[i]);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        assert(hypotheses[i].grammar == hypotheses[0].grammar); <span class="comment">// just a check that the grammars are identical</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    }</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">return</span> out;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> HYP, <span class="keyword">typename</span> t_data&gt;</div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="_grammar_hypothesis_8h.html#a9a48b68b9617c8ece4f550196dd275d9">   60</a></span>&#160;<a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> <a class="code" href="_grammar_hypothesis_8h.html#a9a48b68b9617c8ece4f550196dd275d9">incremental_likelihoods</a>(std::vector&lt;HYP&gt;&amp; hypotheses, t_data&amp; human_data) {</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">// Each row here is a hypothesis, and each column is the likelihood for a sequence of data sets</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Here we check if the previous data point is a subset of the current, and if so, </span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// then we just do the additiona likelihood o fthe set difference </span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// this way, we can pass incremental data without it being too crazy slow</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> out = Matrix::Zero(hypotheses.size(), human_data.size()); </div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> h=0;h&lt;hypotheses.size() and !CTRL_C;h++) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> di=0;di&lt;human_data.size() and !CTRL_C;di++) {</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            out(h,di) =  hypotheses[h].compute_likelihood(human_data[di].<a class="code" href="struct_human_datum.html#aab13b229dfedb8c2466f47a58e710431">given_data</a>);           </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }   </div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    }</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    </div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">return</span> out;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;}</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> HYP, <span class="keyword">typename</span> t_data&gt;</div><div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="_grammar_hypothesis_8h.html#a63b3177c1d70c31bab2e3e55564e45c4">   78</a></span>&#160;<a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> <a class="code" href="_grammar_hypothesis_8h.html#a63b3177c1d70c31bab2e3e55564e45c4">model_predictions</a>(std::vector&lt;HYP&gt;&amp; hypotheses, t_data&amp; human_data) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    </div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> out = Matrix::Zero(hypotheses.size(), human_data.size());</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> h=0;h&lt;hypotheses.size();h++) {</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> di=0;di&lt;human_data.size();di++) {</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        out(h,di) =  1.0*hypotheses[h].callOne(human_data[di].<a class="code" href="struct_human_datum.html#ab4676fce2bedc28aca179a17fce99be2">predict_data</a>.x, 0);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    }</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span> out; </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;}</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> HYP, <span class="keyword">typename</span> t_datum, <span class="keyword">typename</span> t_data=std::vector&lt;t_datum&gt;&gt;  <span class="comment">// HYP here is the type of the thing we do inference over</span></div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html">   91</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_grammar_hypothesis.html">GrammarHypothesis</a> : <span class="keyword">public</span> <a class="code" href="class_m_c_m_cable.html">MCMCable</a>&lt;GrammarHypothesis&lt;HYP, t_datum, t_data&gt;, t_datum, t_data&gt;  {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">/* This class stores a hypothesis of grammar probabilities. The t_data here is defined to be the above tuple and datum is ignored */</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            </div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a27fdb926401378fc46373ee57bb2a21f">   95</a></span>&#160;    <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> <a class="code" href="class_grammar_hypothesis.html#a27fdb926401378fc46373ee57bb2a21f">x</a>; </div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#ae3aa5981689e75e3eccc343c838b8f47">   96</a></span>&#160;    <a class="code" href="class_grammar.html">Grammar</a>* <a class="code" href="class_grammar_hypothesis.html#ae3aa5981689e75e3eccc343c838b8f47">grammar</a>;</div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a2147efc4d1268e115803bd34f63f1c35">   97</a></span>&#160;    <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>* <a class="code" href="class_grammar_hypothesis.html#a2147efc4d1268e115803bd34f63f1c35">C</a>;</div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a90aea1a98b122b01e7a10cc2c7c251d4">   98</a></span>&#160;    <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>* <a class="code" href="class_grammar_hypothesis.html#a90aea1a98b122b01e7a10cc2c7c251d4">LL</a>;</div><div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a7154fb0938913f01dfd85efb76c46250">   99</a></span>&#160;    <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>* <a class="code" href="class_grammar_hypothesis.html#a7154fb0938913f01dfd85efb76c46250">P</a>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    </div><div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a41985a24a133b009328deed14a2b8802">  101</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="class_grammar_hypothesis.html#a41985a24a133b009328deed14a2b8802">logodds_baseline</a>; <span class="comment">// when we choose at random, whats the probability of true-vs-false?</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a1027d3f52f4d1adddd923a18fb393955">  102</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="class_grammar_hypothesis.html#a1027d3f52f4d1adddd923a18fb393955">logodds_forwardalpha</a>; </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    </div><div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#afd02b96535124c5e205ce7185c64c862">  104</a></span>&#160;    <a class="code" href="class_grammar_hypothesis.html#afd02b96535124c5e205ce7185c64c862">GrammarHypothesis</a>(){};</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    </div><div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#afe25b747b37d7ae984f9d3e4187484d8">  106</a></span>&#160;    <a class="code" href="class_grammar_hypothesis.html#afe25b747b37d7ae984f9d3e4187484d8">GrammarHypothesis</a>(<a class="code" href="class_grammar.html">Grammar</a>* g, <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>* c, <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>* ll, <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>* p) : grammar(g), C(c), LL(ll), P(p) {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        x = Vector::Ones(grammar-&gt;<a class="code" href="class_grammar.html#af25c47a2c5cae2a11720c8454e59290f">count_rules</a>());</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }   </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    </div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a379e7af54d3e1cfd5b70f48fcc423470">  110</a></span>&#160;    <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a>&amp; <a class="code" href="class_grammar_hypothesis.html#a379e7af54d3e1cfd5b70f48fcc423470">getX</a>()                { <span class="keywordflow">return</span> x; }</div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a2e6e231336e00b27bb0a0a1f039d80fa">  111</a></span>&#160;    <span class="keyword">const</span> <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a>&amp; <a class="code" href="class_grammar_hypothesis.html#a2e6e231336e00b27bb0a0a1f039d80fa">getX</a>()<span class="keyword"> const    </span>{ <span class="keywordflow">return</span> x; }</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#aa647148b440db9de4ca97f39c593a0d3">  112</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="class_grammar_hypothesis.html#aa647148b440db9de4ca97f39c593a0d3">get_baseline</a>()<span class="keyword"> const    </span>{ <span class="keywordflow">return</span> exp(-logodds_baseline) / (1+exp(-logodds_baseline)); }</div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a8ac03e561e97660e21669d0ddb64e028">  113</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="class_grammar_hypothesis.html#a8ac03e561e97660e21669d0ddb64e028">get_forwardalpha</a>()<span class="keyword">const </span>{ <span class="keywordflow">return</span> exp(-logodds_forwardalpha) / (1+exp(-logodds_forwardalpha)); }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    </div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a11fd75eee387330535601c9ee9d2f0f9">  115</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="class_grammar_hypothesis.html#a11fd75eee387330535601c9ee9d2f0f9">compute_prior</a>() {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="comment">// we&#39;re going to put a cauchy prior on the transformed space</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        this-&gt;prior = 0.0;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        </div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span> i=0;i&lt;x.size();i++) {</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            this-&gt;prior += <a class="code" href="_random_8h.html#a38e50e2c5d6c7cc6940e63a706c5cfe9">normal_lpdf</a>(x(i), 0.0, 1.0);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        </div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        this-&gt;prior += <a class="code" href="_random_8h.html#a38e50e2c5d6c7cc6940e63a706c5cfe9">normal_lpdf</a>(logodds_baseline, 0.0, 1.0);</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        this-&gt;prior += <a class="code" href="_random_8h.html#a38e50e2c5d6c7cc6940e63a706c5cfe9">normal_lpdf</a>(logodds_forwardalpha, 0.0, 1.0);</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">return</span> this-&gt;prior;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    }</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    </div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// We should not use compute_single_likelihood</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a848ed67089c24b55cc61a4d84e350d05">  129</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="class_grammar_hypothesis.html#a848ed67089c24b55cc61a4d84e350d05">compute_single_likelihood</a>(<span class="keyword">const</span> <a class="code" href="class_bayesable.html#a7c93a2eeab708378eb321745908718d4">t_datum</a>&amp; datum) { assert(0); } </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    </div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#ae565db71afc24d042450e9ed471b4908">  131</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">double</span> <a class="code" href="class_grammar_hypothesis.html#ae565db71afc24d042450e9ed471b4908">compute_likelihood</a>(<span class="keyword">const</span> <a class="code" href="class_bayesable.html#a70a593a67c7d43239ecc06bb4fd06a6b">t_data</a>&amp; data, <span class="keyword">const</span> <span class="keywordtype">double</span> breakout=-<a class="code" href="_numerics_8h.html#a1bb1e42ae1b40cad6e99da0aab8a5576">infinity</a>) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">// This runs the entire model (computing its posterior) to get the likelihood</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">// of the human data</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        </div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> hprior = hypothesis_prior(*C); </div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a> hposterior = (*LL).colwise() + hprior; <span class="comment">// the model&#39;s posterior</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">// now normalize it and convert to probabilities</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;hposterior.cols();i++) {  <span class="comment">// normalize (must be a faster way) for each amount of given data (column)</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            hposterior.col(i) = <a class="code" href="_eigen_numerics_8h.html#a3444ba786055e8a0782bdd5043fdfd0d">lognormalize</a>(hposterior.col(i)).array().exp();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        }</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            </div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> hpredictive = (hposterior.array() * (*P).array()).colwise().sum(); <span class="comment">// elementwise product and then column sum</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        </div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// and now get the human likelihood, using a binomial likelihood (binomial term not needed)</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="keywordtype">float</span> forwardalpha = get_forwardalpha();</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordtype">float</span> baseline     = get_baseline();</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        this-&gt;likelihood = 0.0; <span class="comment">// of the human data</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i=0;i&lt;data.size();i++) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordtype">double</span> p = forwardalpha*hpredictive(i) + (1.0-forwardalpha)*baseline;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            this-&gt;likelihood += log(p)*data[i].cntyes + log(1.0-p)*data[i].cntno;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">//      Vector o = Vector::Ones(predictive.size());</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">//      Vector p = forwardalpha*predictive(i) + o*(1.0-forwardalpha)*baseline; // vector of probabilities</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">//      double proposalLL = p.array.log()*yes_responses + (o-p).array.log()*no_responses;</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">return</span> this-&gt;likelihood;        </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a8d0042f4858879ce2585df382ce78b0a">  160</a></span>&#160;    [[nodiscard]] <span class="keyword">virtual</span> <a class="code" href="class_grammar_hypothesis.html">GrammarHypothesis</a> <a class="code" href="class_grammar_hypothesis.html#a8d0042f4858879ce2585df382ce78b0a">restart</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="class_grammar_hypothesis.html">GrammarHypothesis</a> out(grammar, C, LL, P);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        out.<a class="code" href="class_grammar_hypothesis.html#a41985a24a133b009328deed14a2b8802">logodds_baseline</a> = <a class="code" href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a>(<a class="code" href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a>);     </div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        out.<a class="code" href="class_grammar_hypothesis.html#a1027d3f52f4d1adddd923a18fb393955">logodds_forwardalpha</a> = <a class="code" href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a>(<a class="code" href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a>);     </div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        </div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span> i=0;i&lt;x.size();i++) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            out.<a class="code" href="class_grammar_hypothesis.html#a27fdb926401378fc46373ee57bb2a21f">x</a>(i) = <a class="code" href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a>(<a class="code" href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a>);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">return</span> out;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    </div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    </div><div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a5b642e0ccd5c1cebdbd3f7dfdc81cfcf">  172</a></span>&#160;    [[nodiscard]] <span class="keyword">virtual</span> std::pair&lt;GrammarHypothesis,double&gt; <a class="code" href="class_grammar_hypothesis.html#a5b642e0ccd5c1cebdbd3f7dfdc81cfcf">propose</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <a class="code" href="class_grammar_hypothesis.html">GrammarHypothesis</a> out = *<span class="keyword">this</span>;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="_random_8h.html#ae295082303ce2024a3de1c53dc99568e">flip</a>()){</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            out.<a class="code" href="class_grammar_hypothesis.html#a41985a24a133b009328deed14a2b8802">logodds_baseline</a>     = logodds_baseline     + 0.1*<a class="code" href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a>(<a class="code" href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            out.<a class="code" href="class_grammar_hypothesis.html#a1027d3f52f4d1adddd923a18fb393955">logodds_forwardalpha</a> = logodds_forwardalpha + 0.1*<a class="code" href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a>(<a class="code" href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a>);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }       </div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keyword">auto</span> i = <a class="code" href="_random_8h.html#a80379e9c4dd11a0b2260f1a4ee934d44">myrandom</a>(x.size()); <span class="comment">// add noise to one coefficient</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            out.<a class="code" href="class_grammar_hypothesis.html#a379e7af54d3e1cfd5b70f48fcc423470">getX</a>()(i) = x(i) + 0.10*<a class="code" href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a>(<a class="code" href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a>);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        </div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">return</span> std::make_pair(out, 0.0);    </div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    </div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a9fb937f94fbe121dcba164f378e99080">  187</a></span>&#160;    <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> <a class="code" href="class_grammar_hypothesis.html#a9fb937f94fbe121dcba164f378e99080">hypothesis_prior</a>(<a class="code" href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a>&amp; C) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">// take a matrix of counts (each row is a hypothesis, is column is a primitive)</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="comment">// and return a prior for each hypothesis under my own X</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// (IF this was just  aPCFG, which its not, we&#39;d use something like lognormalize(C*proposal.getX()))</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            </div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> out(C.rows()); <span class="comment">// one for each hypothesis</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        </div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// get the marginal probability of the counts via  dirichlet-multinomial</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> etothex = x.array().exp(); <span class="comment">// translate [-inf,inf] into [0,inf]</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span> i=0;i&lt;C.rows();i++) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordtype">double</span> lp = 0.0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordtype">size_t</span> offset = 0; <span class="comment">// </span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> nt=0;nt&lt;grammar-&gt;<a class="code" href="class_grammar.html#abf841bc64ac19cb9872a8362f5e5731a">count_nonterminals</a>();nt++) { <span class="comment">// each nonterminal in the grammar is a DM</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                <span class="keywordtype">size_t</span> nrules = grammar-&gt;<a class="code" href="class_grammar.html#af25c47a2c5cae2a11720c8454e59290f">count_rules</a>( (nonterminal_t) nt);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <span class="keywordflow">if</span>(nrules==1) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> a = <a class="code" href="_eigen_numerics_8h.html#a5c19fc7b6441ef5882de44b7f1fe67f3">eigenslice</a>(etothex,offset,nrules); <span class="comment">// TODO: seqN doesn&#39;t seem tow ork with this c++ version</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <a class="code" href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a> c = <a class="code" href="_eigen_numerics_8h.html#a5c19fc7b6441ef5882de44b7f1fe67f3">eigenslice</a>(C.row(i),offset,nrules);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordtype">double</span> n = a.sum();</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <span class="keywordflow">if</span>(n==0) <span class="keywordflow">continue</span>; <span class="comment">// skip zero count else lgamma is crazy</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="keywordtype">double</span> a0 = c.sum();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                assert(a0 != 0.0);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                lp += std::lgamma(n+1) + std::lgamma(a0) - std::lgamma(n+a0) </div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                     + (c.array() + a.array()).array().lgamma().sum() </div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                     - (c.array()+1).array().lgamma().sum() </div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                     - a.array().lgamma().sum();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                offset += nrules;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        </div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            out(i) = lp;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        </div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        </div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="keywordflow">return</span> out;     </div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    }</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    </div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    </div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a8a64510ebb2af15474bdae7169049c94">  225</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_grammar_hypothesis.html#a8a64510ebb2af15474bdae7169049c94">operator==</a>(<span class="keyword">const</span> <a class="code" href="class_grammar_hypothesis.html">GrammarHypothesis&lt;HYP,t_datum,t_data&gt;</a>&amp; h)<span class="keyword"> const </span>{</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordflow">return</span> C == h.<a class="code" href="class_grammar_hypothesis.html#a2147efc4d1268e115803bd34f63f1c35">C</a> and LL == h.<a class="code" href="class_grammar_hypothesis.html#a90aea1a98b122b01e7a10cc2c7c251d4">LL</a> and P == h.<a class="code" href="class_grammar_hypothesis.html#a7154fb0938913f01dfd85efb76c46250">P</a> and </div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                (getX()-h.<a class="code" href="class_grammar_hypothesis.html#a379e7af54d3e1cfd5b70f48fcc423470">getX</a>()).array().abs().sum() == 0.0 and</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                logodds_baseline == h.<a class="code" href="class_grammar_hypothesis.html#a41985a24a133b009328deed14a2b8802">logodds_baseline</a> and</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                logodds_forwardalpha == logodds_forwardalpha;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    </div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    </div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a75267d7b68cd9b3634f84a464877c07c">  233</a></span>&#160;    <span class="keyword">virtual</span> std::string <a class="code" href="class_grammar_hypothesis.html#a75267d7b68cd9b3634f84a464877c07c">string</a>()<span class="keyword"> const </span>{</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="comment">// For now we just provide partial information</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;GrammarHypothesis[&quot;</span>+<a class="code" href="_strings_8h.html#a4bc77a6f47e3046cc934b49f5e03a56f">str</a>(this-&gt;posterior) + <span class="stringliteral">&quot;\t&quot;</span> + <a class="code" href="_strings_8h.html#a4bc77a6f47e3046cc934b49f5e03a56f">str</a>(this-&gt;get_baseline()) + <span class="stringliteral">&quot;\t&quot;</span> + <a class="code" href="_strings_8h.html#a4bc77a6f47e3046cc934b49f5e03a56f">str</a>(this-&gt;get_forwardalpha())+<span class="stringliteral">&quot;]&quot;</span>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div><div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="class_grammar_hypothesis.html#a5b269a5ed433b94f6b2796f30a15fd9e">  237</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">size_t</span> <a class="code" href="class_grammar_hypothesis.html#a5b269a5ed433b94f6b2796f30a15fd9e">hash</a>()<span class="keyword"> const        </span>{ <span class="keywordflow">return</span> 1.0; }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;};</div><div class="ttc" id="_grammar_hypothesis_8h_html_a63b3177c1d70c31bab2e3e55564e45c4"><div class="ttname"><a href="_grammar_hypothesis_8h.html#a63b3177c1d70c31bab2e3e55564e45c4">model_predictions</a></div><div class="ttdeci">Matrix model_predictions(std::vector&lt; HYP &gt; &amp;hypotheses, t_data &amp;human_data)</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:78</div></div>
<div class="ttc" id="_random_8h_html_a80379e9c4dd11a0b2260f1a4ee934d44"><div class="ttname"><a href="_random_8h.html#a80379e9c4dd11a0b2260f1a4ee934d44">myrandom</a></div><div class="ttdeci">T myrandom(T max)</div><div class="ttdef"><b>Definition:</b> Random.h:81</div></div>
<div class="ttc" id="class_grammar_html"><div class="ttname"><a href="class_grammar.html">Grammar</a></div><div class="ttdef"><b>Definition:</b> Grammar.h:18</div></div>
<div class="ttc" id="_strings_8h_html_a4bc77a6f47e3046cc934b49f5e03a56f"><div class="ttname"><a href="_strings_8h.html#a4bc77a6f47e3046cc934b49f5e03a56f">str</a></div><div class="ttdeci">std::string str(T x)</div><div class="ttdef"><b>Definition:</b> Strings.h:7</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a41985a24a133b009328deed14a2b8802"><div class="ttname"><a href="class_grammar_hypothesis.html#a41985a24a133b009328deed14a2b8802">GrammarHypothesis::logodds_baseline</a></div><div class="ttdeci">float logodds_baseline</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:101</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a5b642e0ccd5c1cebdbd3f7dfdc81cfcf"><div class="ttname"><a href="class_grammar_hypothesis.html#a5b642e0ccd5c1cebdbd3f7dfdc81cfcf">GrammarHypothesis::propose</a></div><div class="ttdeci">virtual std::pair&lt; GrammarHypothesis, double &gt; propose() const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:172</div></div>
<div class="ttc" id="_random_8h_html_a38e50e2c5d6c7cc6940e63a706c5cfe9"><div class="ttname"><a href="_random_8h.html#a38e50e2c5d6c7cc6940e63a706c5cfe9">normal_lpdf</a></div><div class="ttdeci">double normal_lpdf(double x, double mu=0.0, double sd=1.0)</div><div class="ttdef"><b>Definition:</b> Random.h:35</div></div>
<div class="ttc" id="_grammar_hypothesis_8h_html_ae5fe4a8381157a1e6b65f806a80e941e"><div class="ttname"><a href="_grammar_hypothesis_8h.html#ae5fe4a8381157a1e6b65f806a80e941e">counts</a></div><div class="ttdeci">Vector counts(HYP &amp;h)</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:25</div></div>
<div class="ttc" id="struct_human_datum_html_aab13b229dfedb8c2466f47a58e710431"><div class="ttname"><a href="struct_human_datum.html#aab13b229dfedb8c2466f47a58e710431">HumanDatum::given_data</a></div><div class="ttdeci">t_learnerdata given_data</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:17</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a379e7af54d3e1cfd5b70f48fcc423470"><div class="ttname"><a href="class_grammar_hypothesis.html#a379e7af54d3e1cfd5b70f48fcc423470">GrammarHypothesis::getX</a></div><div class="ttdeci">Vector &amp; getX()</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:110</div></div>
<div class="ttc" id="class_m_c_m_cable_html"><div class="ttname"><a href="class_m_c_m_cable.html">MCMCable</a></div><div class="ttdef"><b>Definition:</b> MCMCable.h:13</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_afe25b747b37d7ae984f9d3e4187484d8"><div class="ttname"><a href="class_grammar_hypothesis.html#afe25b747b37d7ae984f9d3e4187484d8">GrammarHypothesis::GrammarHypothesis</a></div><div class="ttdeci">GrammarHypothesis(Grammar *g, Matrix *c, Matrix *ll, Matrix *p)</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:106</div></div>
<div class="ttc" id="_numerics_8h_html"><div class="ttname"><a href="_numerics_8h.html">Numerics.h</a></div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a8a64510ebb2af15474bdae7169049c94"><div class="ttname"><a href="class_grammar_hypothesis.html#a8a64510ebb2af15474bdae7169049c94">GrammarHypothesis::operator==</a></div><div class="ttdeci">virtual bool operator==(const GrammarHypothesis&lt; HYP, t_datum, t_data &gt; &amp;h) const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:225</div></div>
<div class="ttc" id="class_grammar_html_abf841bc64ac19cb9872a8362f5e5731a"><div class="ttname"><a href="class_grammar.html#abf841bc64ac19cb9872a8362f5e5731a">Grammar::count_nonterminals</a></div><div class="ttdeci">size_t count_nonterminals() const</div><div class="ttdef"><b>Definition:</b> Grammar.h:79</div></div>
<div class="ttc" id="_eigen_numerics_8h_html_a3444ba786055e8a0782bdd5043fdfd0d"><div class="ttname"><a href="_eigen_numerics_8h.html#a3444ba786055e8a0782bdd5043fdfd0d">lognormalize</a></div><div class="ttdeci">Vector lognormalize(const Vector &amp;v)</div><div class="ttdef"><b>Definition:</b> EigenNumerics.h:29</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a9fb937f94fbe121dcba164f378e99080"><div class="ttname"><a href="class_grammar_hypothesis.html#a9fb937f94fbe121dcba164f378e99080">GrammarHypothesis::hypothesis_prior</a></div><div class="ttdeci">Vector hypothesis_prior(Matrix &amp;C)</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:187</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a8d0042f4858879ce2585df382ce78b0a"><div class="ttname"><a href="class_grammar_hypothesis.html#a8d0042f4858879ce2585df382ce78b0a">GrammarHypothesis::restart</a></div><div class="ttdeci">virtual GrammarHypothesis restart() const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:160</div></div>
<div class="ttc" id="_random_8h_html_a112726533590b471a9443cdb65f766bc"><div class="ttname"><a href="_random_8h.html#a112726533590b471a9443cdb65f766bc">normal</a></div><div class="ttdeci">thread_local std::normal_distribution&lt; float &gt; normal(0.0, 1.0)</div></div>
<div class="ttc" id="struct_human_datum_html_a3569e7634ea9badbe48105cb3a4e5800"><div class="ttname"><a href="struct_human_datum.html#a3569e7634ea9badbe48105cb3a4e5800">HumanDatum::cntyes</a></div><div class="ttdeci">size_t cntyes</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:15</div></div>
<div class="ttc" id="struct_human_datum_html_a713ec5993bc2a348a73f292865a6ddcf"><div class="ttname"><a href="struct_human_datum.html#a713ec5993bc2a348a73f292865a6ddcf">HumanDatum::cntno</a></div><div class="ttdeci">size_t cntno</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:16</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a2147efc4d1268e115803bd34f63f1c35"><div class="ttname"><a href="class_grammar_hypothesis.html#a2147efc4d1268e115803bd34f63f1c35">GrammarHypothesis::C</a></div><div class="ttdeci">Matrix * C</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:97</div></div>
<div class="ttc" id="class_grammar_html_af25c47a2c5cae2a11720c8454e59290f"><div class="ttname"><a href="class_grammar.html#af25c47a2c5cae2a11720c8454e59290f">Grammar::count_rules</a></div><div class="ttdeci">size_t count_rules(const nonterminal_t nt) const</div><div class="ttdef"><b>Definition:</b> Grammar.h:88</div></div>
<div class="ttc" id="_eigen_numerics_8h_html_a5c19fc7b6441ef5882de44b7f1fe67f3"><div class="ttname"><a href="_eigen_numerics_8h.html#a5c19fc7b6441ef5882de44b7f1fe67f3">eigenslice</a></div><div class="ttdeci">Vector eigenslice(const Vector &amp;v, const size_t offset, const size_t len)</div><div class="ttdef"><b>Definition:</b> EigenNumerics.h:33</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_aa647148b440db9de4ca97f39c593a0d3"><div class="ttname"><a href="class_grammar_hypothesis.html#aa647148b440db9de4ca97f39c593a0d3">GrammarHypothesis::get_baseline</a></div><div class="ttdeci">float get_baseline() const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:112</div></div>
<div class="ttc" id="_grammar_hypothesis_8h_html_a9a48b68b9617c8ece4f550196dd275d9"><div class="ttname"><a href="_grammar_hypothesis_8h.html#a9a48b68b9617c8ece4f550196dd275d9">incremental_likelihoods</a></div><div class="ttdeci">Matrix incremental_likelihoods(std::vector&lt; HYP &gt; &amp;hypotheses, t_data &amp;human_data)</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:60</div></div>
<div class="ttc" id="_eigen_numerics_8h_html"><div class="ttname"><a href="_eigen_numerics_8h.html">EigenNumerics.h</a></div></div>
<div class="ttc" id="struct_human_datum_html"><div class="ttname"><a href="struct_human_datum.html">HumanDatum</a></div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:9</div></div>
<div class="ttc" id="_numerics_8h_html_a1bb1e42ae1b40cad6e99da0aab8a5576"><div class="ttname"><a href="_numerics_8h.html#a1bb1e42ae1b40cad6e99da0aab8a5576">infinity</a></div><div class="ttdeci">const double infinity</div><div class="ttdef"><b>Definition:</b> Numerics.h:12</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a2e6e231336e00b27bb0a0a1f039d80fa"><div class="ttname"><a href="class_grammar_hypothesis.html#a2e6e231336e00b27bb0a0a1f039d80fa">GrammarHypothesis::getX</a></div><div class="ttdeci">const Vector &amp; getX() const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:111</div></div>
<div class="ttc" id="_eigen_numerics_8h_html_aca2956bc379bce2ed88ab3c0e1b61d1d"><div class="ttname"><a href="_eigen_numerics_8h.html#aca2956bc379bce2ed88ab3c0e1b61d1d">Vector</a></div><div class="ttdeci">Eigen::VectorXf Vector</div><div class="ttdef"><b>Definition:</b> EigenNumerics.h:7</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a8ac03e561e97660e21669d0ddb64e028"><div class="ttname"><a href="class_grammar_hypothesis.html#a8ac03e561e97660e21669d0ddb64e028">GrammarHypothesis::get_forwardalpha</a></div><div class="ttdeci">float get_forwardalpha() const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:113</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a1027d3f52f4d1adddd923a18fb393955"><div class="ttname"><a href="class_grammar_hypothesis.html#a1027d3f52f4d1adddd923a18fb393955">GrammarHypothesis::logodds_forwardalpha</a></div><div class="ttdeci">float logodds_forwardalpha</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:102</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a7154fb0938913f01dfd85efb76c46250"><div class="ttname"><a href="class_grammar_hypothesis.html#a7154fb0938913f01dfd85efb76c46250">GrammarHypothesis::P</a></div><div class="ttdeci">Matrix * P</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:99</div></div>
<div class="ttc" id="_random_8h_html_a5f624a2c2624420c2948d7a80eac6f52"><div class="ttname"><a href="_random_8h.html#a5f624a2c2624420c2948d7a80eac6f52">rng</a></div><div class="ttdeci">thread_local std::mt19937 rng(rd())</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a75267d7b68cd9b3634f84a464877c07c"><div class="ttname"><a href="class_grammar_hypothesis.html#a75267d7b68cd9b3634f84a464877c07c">GrammarHypothesis::string</a></div><div class="ttdeci">virtual std::string string() const</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:233</div></div>
<div class="ttc" id="class_bayesable_html_a7c93a2eeab708378eb321745908718d4"><div class="ttname"><a href="class_bayesable.html#a7c93a2eeab708378eb321745908718d4">Bayesable&lt; Args... &gt;::t_datum</a></div><div class="ttdeci">Args... t_datum</div><div class="ttdef"><b>Definition:</b> Bayesable.h:23</div></div>
<div class="ttc" id="_random_8h_html_ae295082303ce2024a3de1c53dc99568e"><div class="ttname"><a href="_random_8h.html#ae295082303ce2024a3de1c53dc99568e">flip</a></div><div class="ttdeci">bool flip()</div><div class="ttdef"><b>Definition:</b> Random.h:106</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a848ed67089c24b55cc61a4d84e350d05"><div class="ttname"><a href="class_grammar_hypothesis.html#a848ed67089c24b55cc61a4d84e350d05">GrammarHypothesis::compute_single_likelihood</a></div><div class="ttdeci">virtual double compute_single_likelihood(const t_datum &amp;datum)</div><div class="ttdoc">Compute the likelihood of a single data point. </div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:129</div></div>
<div class="ttc" id="class_grammar_hypothesis_html"><div class="ttname"><a href="class_grammar_hypothesis.html">GrammarHypothesis</a></div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:91</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_ae565db71afc24d042450e9ed471b4908"><div class="ttname"><a href="class_grammar_hypothesis.html#ae565db71afc24d042450e9ed471b4908">GrammarHypothesis::compute_likelihood</a></div><div class="ttdeci">virtual double compute_likelihood(const t_data &amp;data, const double breakout=-infinity)</div><div class="ttdoc">Compute the likelihood of a collection of data, by calling compute_single_likelihood on each...</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:131</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_ae3aa5981689e75e3eccc343c838b8f47"><div class="ttname"><a href="class_grammar_hypothesis.html#ae3aa5981689e75e3eccc343c838b8f47">GrammarHypothesis::grammar</a></div><div class="ttdeci">Grammar * grammar</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:96</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a5b269a5ed433b94f6b2796f30a15fd9e"><div class="ttname"><a href="class_grammar_hypothesis.html#a5b269a5ed433b94f6b2796f30a15fd9e">GrammarHypothesis::hash</a></div><div class="ttdeci">virtual size_t hash() const</div><div class="ttdoc">Default hash function. </div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:237</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a27fdb926401378fc46373ee57bb2a21f"><div class="ttname"><a href="class_grammar_hypothesis.html#a27fdb926401378fc46373ee57bb2a21f">GrammarHypothesis::x</a></div><div class="ttdeci">Vector x</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:95</div></div>
<div class="ttc" id="_eigen_numerics_8h_html_a645222978e81acfb2523a9bce34aecc0"><div class="ttname"><a href="_eigen_numerics_8h.html#a645222978e81acfb2523a9bce34aecc0">Matrix</a></div><div class="ttdeci">Eigen::MatrixXf Matrix</div><div class="ttdef"><b>Definition:</b> EigenNumerics.h:8</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a11fd75eee387330535601c9ee9d2f0f9"><div class="ttname"><a href="class_grammar_hypothesis.html#a11fd75eee387330535601c9ee9d2f0f9">GrammarHypothesis::compute_prior</a></div><div class="ttdeci">double compute_prior()</div><div class="ttdoc">Compute the prior – defaultly not defined. </div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:115</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_a90aea1a98b122b01e7a10cc2c7c251d4"><div class="ttname"><a href="class_grammar_hypothesis.html#a90aea1a98b122b01e7a10cc2c7c251d4">GrammarHypothesis::LL</a></div><div class="ttdeci">Matrix * LL</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:98</div></div>
<div class="ttc" id="struct_human_datum_html_ab4676fce2bedc28aca179a17fce99be2"><div class="ttname"><a href="struct_human_datum.html#ab4676fce2bedc28aca179a17fce99be2">HumanDatum::predict_data</a></div><div class="ttdeci">t_learnerdatum predict_data</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:18</div></div>
<div class="ttc" id="class_grammar_hypothesis_html_afd02b96535124c5e205ce7185c64c862"><div class="ttname"><a href="class_grammar_hypothesis.html#afd02b96535124c5e205ce7185c64c862">GrammarHypothesis::GrammarHypothesis</a></div><div class="ttdeci">GrammarHypothesis()</div><div class="ttdef"><b>Definition:</b> GrammarHypothesis.h:104</div></div>
<div class="ttc" id="class_bayesable_html_a70a593a67c7d43239ecc06bb4fd06a6b"><div class="ttname"><a href="class_bayesable.html#a70a593a67c7d43239ecc06bb4fd06a6b">Bayesable&lt; Args... &gt;::t_data</a></div><div class="ttdeci">std::vector&lt; Args... &gt; t_data</div><div class="ttdef"><b>Definition:</b> Bayesable.h:24</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
